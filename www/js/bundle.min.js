!function(t){t.module("thebusao",["ionic","ngMap","ui.router","ngCordova"]).run(["$ionicPlatform",function(t){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e,o){t.state("map",{url:"/map",templateUrl:"templates/map/map.html",controller:"mapController as vm"}),e.otherwise("/map"),o.interceptors.push("authFactory")}]).constant("URL","https://thebusao.herokuapp.com/api"),function(){"use strict";function e(t,e,o){function n(n){return n.headers=n.headers||{},t.localStorage.getItem("data")&&n.url!=o+"/v1/token"&&(n.headers["x-access-token"]=t.localStorage.getItem("data")),n||e.when(n)}function a(t){return t||e.when(t)}function i(t){return e.reject(t)}return{request:n,response:a,responseError:i,requestError:i}}t.module("thebusao").factory("authFactory",e),e.$inject=["$window","$q","URL"]}(),function(){"use strict";function e(t,e,o,n,a,i){function r(){function n(t){return o.localStorage.setItem("data",t.data.token),!0}function a(t){return!1}return t.get(e+"/v1/token").then(n)["catch"](a)}function c(t,e){function o(t){var e=t?"<img src='img/"+t+".svg' class='svg-inject' />":'<div class="loader"></div';a.show({template:e,animate:"fade-in",showBackdrop:!0})}function n(){a.hide()}t?o(e):n()}function u(t){i.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(t?cordova.plugins.Keyboard.show():cordova.plugins.Keyboard.close())})}return{getTokenValidRequest:r,getLoading:c,keyboard:u}}t.module("thebusao").factory("fixtureFactory",e),e.$inject=["$http","URL","$window","$rootScope","$ionicLoading","$ionicPlatform"]}(),function(){"use strict";function e(t,e,o){return function(){var n={timeout:1e4,enableHighAccuracy:!1},a=o.defer();return e.ready(function(){function e(t){a.resolve(t)}function o(t){a.reject(t)}t.getCurrentPosition(n).then(e,o)}),a.promise}}t.module("thebusao").factory("geolocationService",e),e.$inject=["$cordovaGeolocation","$ionicPlatform","$q"]}(),function(){"use strict";function e(t,e,o,n,a,i,r){function c(){t.getTokenValidRequest().then(function(t){s()})}function u(o){e.getVehicles(o).then(function(e){0==e.length?(h.alertPopup=a.alert({title:"Aviso!",template:"Não a ônibus disponível no momento",okType:"button-calm"}),h.bus=""):(h.busAll=e,h.search=e[0].Denomicao,h.large=!1,p(e)),t.getLoading(!1)})}function s(o){e.getLines(o).then(function(e){h.linesAll=e,t.getLoading(!1)})}function l(e){t.keyboard(!1),n(function(){t.getLoading(!0),u(e.CodigoLinha)},1e3)}function d(t,e){h.bus=e,h.map.showInfoWindow("bal",h.bus.CodigoVeiculo)}function g(){t.getLoading(!0,"gps"),r().then(function(e){h.userPosition=[],h.userPosition[0]=e.coords.latitude,h.userPosition[1]=e.coords.longitude,h.zoom=11,h.map.setCenter(new google.maps.LatLng(e.coords.latitude,e.coords.longitude)),t.getLoading(!1)})["catch"](function(e){t.getLoading(!1),h.alertPopup=a.alert({title:"Aviso!",template:"Para obter sua posição ative seu GPS eclique novamente no icone de localização",okType:"button-calm"})})}function f(){h.search="",h.large=!0}function p(t){1===t.length&&(h.map.setCenter(new google.maps.LatLng(t[0].Lat,t[0].Long)),h.map.setZoom(15))}var h=this;h.linesAll=[],h.busAll=[],h.p=[-5.0958287,-42.7843285],h.zoom=10,h.large=!0,h.setBusMap=l,h.showDetail=d,h.getCenterLocation=g,h.clearSearch=f,t.getLoading(!0),i.getMap().then(function(t){h.map=t,c()})}t.module("thebusao").controller("mapController",e),e.$inject=["fixtureFactory","mapFactory","$scope","$timeout","$ionicPopup","NgMap","geolocationService"]}(),function(){"use strict";function e(t,e,o,n){function a(n){function a(t){return t.data.result}function i(t){null!=t.data&&"Token expirado"===t.data.err&&o.getTokenValidRequest().then(function(t){r.getLines()})}var r=this,c=void 0!=n?n:"";return e.get(t+"/v1/lines/"+c).then(a)["catch"](i)}function i(n){function a(t){return t.data.result}function i(t){null!=t.data&&"Token expirado"===t.data.err&&o.getTokenValidRequest().then(function(t){r.getVehicles()})}var r=this,c=void 0!=n?n:"";return e.get(t+"/v1/vehicles/"+c).then(a)["catch"](i)}return{getLines:a,getVehicles:i}}t.module("thebusao").factory("mapFactory",e),e.$inject=["URL","$http","fixtureFactory","$timeout"]}()}(angular);